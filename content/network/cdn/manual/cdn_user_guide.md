---
title: "CDN 操作指南"
description: 介绍如何创建和使用 CDN。
keyword: CDN 服务, 域名, 缓存
draft: false
weight: 2
---

## 购买 CDN 服务

从创建 CDN 到可以使用大致需要 30 分钟左右，您要使用 CDN 的域名必须进行备案。

**第一步：创建域名(domain)**

1. 登录管理控制台，选择**产品与服务** > **网络服务** > **CDN 服务**，进入 CDN 页面。

2. 点击**购买**，弹出 **CDN 服务**窗口。

   ![](/network/cdn/_images/create_cdn_1.png)

3. 点击**添加域名**，弹出**添加域名**窗口。

4. 输入主域名，点击**提交**。

   例如，您要为 cdnexample.qingcloud.com 加速，则它的主域名是 qingcloud.com。

**第二步：创建域名记录(子域名)**

1. 点击**创建域名记录**，弹出**添加域名**窗口。

2. 配置域名记录。
   ![](/network/cdn/_images/create_cdn_3.png)

   * **名称**：填写你要加速的子域名。子域名指域名中除去主域名的部分，如: cdnexample.qingcloud.com 中的 cdnexample。

   * **回源地址**：您源站的地址，您静态资源的所在站点，当 CDN 中不存在请求的内容时，会去源站请求资源返回给用户并且缓存在 CDN 缓存服务器中。可填写 IP 地址或域名，如果是绑定 DDoS 防护的域名记录其回源地址只能是公网 IP 地址。

   * **回源协议**：选择回源协议。

   * **HTTPS 服务**：选择是开启 HTTPS 服务。如需开启，则点击 `同时支持 HTTP/HTTPS 服务` 或 `强制 HTTPS 服务`，然后在证书列表中选择一个要使用的证书。

     > **说明**
     >
     > * 使用 HTTPS 只支持网页类型加速，不支持下载和点播。
     > * 使用 `强制 HTTPS 服务` 会让 HTTP 访问的用户跳转成 HTTPS 访问。

**第三步：选择节点类型**

1. 不同类型的节点背后对应不同的资源池，通常情况下，选择``网页``即可。

   ![](/network/cdn/_images/create_cdn_5.png)

2. 点击**提交**，开始创建。

## 配置缓存策略

在 CDN 列表页点击域名记录进入 CDN 详情页，在**缓存策略**区域，点击**创建**即可进行配置。

![](/network/cdn/_images/create_cache_rule_0.png)

常见的缓存规则书写规则：

* 如果要缓存 cdnexample.qingcloud.com/image 下的 png jpg gif 可以使用/image/.*(png|jpg|gif)
* 如果要缓存 cdnexample.qingcloud.com 下的所有 mp4 js png jpg html 可以使用 /.*(png|jpg|gif|mp4|js|html)
* 只允许一个 最多只允许一个 *

缓存策略参数说如下：

* **名称**：名称是用帮助记忆该条规则的
* **路径**： 对哪些路径下的哪些文件应用该缓存规则
* **缓存时间**： 对路径中的文件的缓存时间单位是秒
* **优先级**： 如果有多条缓存规则，路径可能存在冲突，优先级高的规则优先生效，优先级数字越小优先级越高。
* **不遵循源站缓存**： 如果 header 中的 Cache Control 是 private，CDN 默认不缓存该文件。但如果勾选此参数，CDN 会忽略 Cache Control 头强制缓存。
* **忽略 URL 中的查询字符串**： 如果带有查询串，CDN 默认不缓存该资源。但如果勾选此参数，则会强制缓存。

## 配置访问控制规则

在 CDN 列表页点击域名记录进入 CDN 详情页，在**访问控制**区域，点击**设置**即可进行配置。配置完成后，点击**应用修改**使配置生效。

![](/network/cdn/_images/create_access_rule_1.png)

**参数说明**：

* **名称**：名称用于帮助记忆该条规则。
* **行为**：用黑名单还是白名单控制访问，黑名单表示列表中的 referer 禁止访问；白名单表示只允许 referer 列表中的站点访问。
* **Referers**：从一个页面请求资源或跳转，会存在一个 referer 信息表示从哪个页面发起的请求。可以用 * 表示所有子域名，如 *.baiud.cm *.google.com。
* **允许请求头中 Referer 为空的请求**： 当用户直接在访问该路径时 referer 为空，是否允许访问。

## 使用 CDN 为站点进行加速

在您使用的 DNS 服务商处配置 CNAME，您的域名就可以使用 CDN 进行加速了。CNAME 在 CDN 服务详情页可以查看。

![](/network/cdn/_images/use_cdn.png)

## 修改回源协议 HTTPS/HTTP

> **注意**
>
> 修改协议可能会造成大量回源，请谨慎使用。


如果想修改当前协议，可以在**域名管理**详情页，勾选域名，点击**更多操作**进行修改。

![](/network/cdn/_images/enable_https.png)


## 查看监控

在 CDN 详情页的**监控**页签，为用户提供各类数据报表业务，包括流量，访问次数，带宽，热门访问地区，热门访问资源等。

> **说明**
>
> 各项统信息会有 10 分钟左右的延时。

* 带宽：单位 Mbps，该带宽为 5 分钟为粒度的峰值带宽。
* 流量：单位 MB，为 5 分钟粒度的总流量。 
* 访问次数：用户请求 CDN 的次数。
* 热门访问地区：统计各地区的请求次数。
* 热门访问资源：统计用户该记录下访问次数最多的文件。

<!--带宽监控-->

<!--![](/network/cdn/_images/bandwidth.png)-->

<!--流量监控-->

<!--![](/network/cdn/_images/flow.png)-->

<!--访问次数监控-->

<!--![](/network/cdn/_images/access.png)-->

<!--访问地区监控-->

<!--![](/network/cdn/_images/top_area.png)-->

<!--热门访问资源监控-->      

<!--![](/network/cdn/_images/top_url.png)-->

## 查看日志

在 CDN 详情页的**日志**页签，提供了从 CDN 缓存服务器中得到的原始访问数据，默认提供的分析维度比较少，可以下载原始日志进行更多维度的分析。默认保存 10 天的日志。

## 清除 CDN 缓存

当您更新了文件，但是该文件的旧版本可能已经被 CDN 缓存。需要手动清除 CDN 的缓存，重新回源去拿最新的文件。

1. 在左侧菜单栏，点击**清除 CDN 缓存**。

   ![](/network/cdn/_images/refresh_1.png)

2. 点击**创建**。

3. 填写需要刷新的文件或者目录的 URL，点击**提交**。

   URL 需要以 `http://` 或 `https://` 开头。

## CDN 内容预取

当您有较大的文件需要提前缓存到 CDN 的节点上的时候可以使用预取功能，该功能会模拟用户请求使文件提前缓存到 CDN 中。

1. 在左侧菜单栏，点击**内容预取**。

2. 点击**创建**，填写需要预取的文件 URL。

   URL 需要以 `http://` 或 `https://` 开头。

   ![](/network/cdn/_images/purge_1.png)